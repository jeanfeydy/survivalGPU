<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>survivalGPU : Fast survival analysis • survivalGPU</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="survivalGPU : Fast survival analysis">
<meta property="og:description" content="survivalGPU">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survivalGPU</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Models</li>
    <li>
      <a href="../articles/coxPH.html">Cox Proportional Hazards regression</a>
    </li>
    <li>
      <a href="../articles/WCE.html">Weighted Cumulative Exposure : Signal detection</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../articles/python_connect.html">Python Configuration</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jeanfeydy/survivalGPU/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>survivalGPU : Fast survival analysis</h1>
                        <h4 data-toc-skip class="author">Alexis van
STRAATEN</h4>
            
            <h4 data-toc-skip class="date">2023-11-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jeanfeydy/survivalGPU/blob/HEAD/../vignettes/survivalGPU.Rmd" class="external-link"><code>../vignettes/survivalGPU.Rmd</code></a></small>
      <div class="hidden name"><code>survivalGPU.Rmd</code></div>

    </div>

    
    
<p>The survivalGPU library allows you to perform survival analyzes using
the resources of Graphic Processing Units (GPU) in order to accelerate
the speed of calculations. Currently, two models have been implemented
:</p>
<ul>
<li>Cox<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a><br>
</li>
<li>WCE<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>
(Weighted Cumulative Exposure)</li>
</ul>
<p>It’s also possible to use the library without having Graphics
Processing Units (with CPU).</p>
<p>An important thing for this package was to take the same inputs from
<code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">survival::coxph()</a></code> for Cox models and <code><a href="https://rdrr.io/pkg/WCE/man/WCE.html" class="external-link">WCE::WCE</a></code>
for WCE models. So after being inspired by these functions, they were
rewritten in python with CUDA to make it compatible with CUDA
drivers.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jeanfeydy/survivalGPU" class="external-link">survivalGPU</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">WCE</span><span class="op">)</span></span></code></pre></div>
<p>During the library loading, we can see if CUDA drivers were detected,
and if they are operational. It’s also possible to check it with
<code><a href="../reference/use_cuda.html">use_cuda()</a></code> function. For the examples, we will define in
advance the number of bootstraps we will use: if the CUDA drivers are
operational, we will execute 1000 bootstraps with the GPU, otherwise 50
bootstraps with the CPU, also adjusting the batchsize argument.
Batchsize argument is used to put a limit on the number of models to do
at the same time. This is very important if you want to run several
bootstraps, because too many models at the same time can saturate the
RAM memory. Also, the number of bootstrap should be a multiple of the
batchsize.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/use_cuda.html">use_cuda</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_bootstrap</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span>  <span class="va">batchsize</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">n_bootstrap</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span>  <span class="va">batchsize</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s make an example with <code>drugdata</code> dataset from WCE
package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">drugdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">drugdata</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="coxphgpu">
<code>coxphGPU()</code><a class="anchor" aria-label="anchor" href="#coxphgpu"></a>
</h2>
<p><code><a href="../reference/coxphGPU.html">coxphGPU()</a></code> is constructed in the same way as
<code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">survival::coxph()</a></code>, with in the formula an object of class
‘Surv’ of type ‘counting’, i.e. with the arguments Start and Stop, and
the event variable.</p>
<p>The <code>summary</code> of a coxphGPU object is the same as a coxph
object, a table with the estimated coefficients for the covariates,
standards errors, and a significance test (Pr(&gt;|z|)).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coxphGPU</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coxphGPU.html">coxphGPU</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">Start</span>, time2 <span class="op">=</span> <span class="va">Stop</span>, event <span class="op">=</span> <span class="va">Event</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span>,</span>
<span>  data <span class="op">=</span> <span class="va">drugdata</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">coxphGPU</span><span class="op">)</span></span></code></pre></div>
<p>The advantage of survivalGPU is to use bootstrap more easily. The
<code>summary</code> gives the results for the initial model without
bootstrap, and at the end, confidence interval for estimates covariates
with bootstrap, according to <code>conf.int</code> argument.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coxphGPU_bootstrap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coxphGPU.html">coxphGPU</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">Start</span>, <span class="va">Stop</span>, <span class="va">Event</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span>,</span>
<span>  data <span class="op">=</span> <span class="va">drugdata</span>,</span>
<span>  bootstrap <span class="op">=</span> <span class="va">n_bootstrap</span>,</span>
<span>  batchsize <span class="op">=</span> <span class="va">batchsize</span>,</span>
<span>  all.results <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">coxphGPU_bootstrap</span><span class="op">)</span></span></code></pre></div>
<p>Avec le bootstrap, la fonction effectue autant de modèles que de
bootstrap demandé. Pour éviter de saturer la mémoire RAM, la fonction ne
calcul pas les linears predictors, wald.test, etc… for all bootstrap (by
deafult <code>all.results = FALSE</code>), mais donnera toujours tous
les coefficients et weights de la fonction de risque (voir pour les
matrices de variance covariance)</p>
</div>
<div class="section level2">
<h2 id="wcegpu">
<code>wceGPU()</code><a class="anchor" aria-label="anchor" href="#wcegpu"></a>
</h2>
<p>In the same idea as the Cox model, <code>wceGPU</code> uses the same
arguments as the <code><a href="https://rdrr.io/pkg/WCE/man/WCE.html" class="external-link">WCE::WCE</a></code> function. The summary changes
slightly with the appearance of confidence intervals without bootstrap
for the estimators of the covariates.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wce_gpu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wceGPU.html">wceGPU</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">drugdata</span>, nknots <span class="op">=</span> <span class="fl">1</span>, cutoff <span class="op">=</span> <span class="fl">90</span>, id <span class="op">=</span> <span class="st">"Id"</span>,</span>
<span>  event <span class="op">=</span> <span class="st">"Event"</span>, start <span class="op">=</span> <span class="st">"Start"</span>, stop <span class="op">=</span> <span class="st">"Stop"</span>,</span>
<span>  expos <span class="op">=</span> <span class="st">"dose"</span>, covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span>,</span>
<span>  constrained <span class="op">=</span> <span class="cn">FALSE</span>, aic <span class="op">=</span> <span class="cn">FALSE</span>, confint <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">wce_gpu</span><span class="op">)</span></span></code></pre></div>
<p>We can display the risk function of the model in order to observe the
weights attributed to each time until the defined cutoff.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">wce_gpu</span><span class="op">)</span></span></code></pre></div>
<p>By applying <code><a href="../reference/wceGPU.html">wceGPU()</a></code> with bootstrap, we obtain the
confidence intervals for the estimates of the covariates and the risk
function on each time, in addition to the information on the initial
model without bootstrap.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wce_gpu_bootstrap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wceGPU.html">wceGPU</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">drugdata</span>, nknots <span class="op">=</span> <span class="fl">1</span>, cutoff <span class="op">=</span> <span class="fl">90</span>, id <span class="op">=</span> <span class="st">"Id"</span>,</span>
<span>  event <span class="op">=</span> <span class="st">"Event"</span>, start <span class="op">=</span> <span class="st">"Start"</span>, stop <span class="op">=</span> <span class="st">"Stop"</span>,</span>
<span>  expos <span class="op">=</span> <span class="st">"dose"</span>, covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span>,</span>
<span>  constrained <span class="op">=</span> <span class="cn">FALSE</span>, aic <span class="op">=</span> <span class="cn">FALSE</span>, confint <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  nbootstraps <span class="op">=</span> <span class="va">n_bootstrap</span>, batchsize <span class="op">=</span> <span class="va">batchsize</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">wce_gpu_bootstrap</span><span class="op">)</span></span></code></pre></div>
<p>Now we can see the estimated risk function with the confidence
intervals thanks to the bootstrap.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">wce_gpu_bootstrap</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Andersen, P. and Gill, R. (1982). Cox’s regression model
for counting processes, a large sample study. Annals of Statistics 10,
1100-1120.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Therneau, T., Grambsch, P., Modeling Survival Data:
Extending the Cox Model. Springer-Verlag, 2000.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Sylvestre MP, Abrahamowicz M. Flexible modeling of the
cumulative effects of time-dependent exposures on the hazard. Stat Med.
2009 Nov 30;28(27):3437-53.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jean FEYDY, Alexis van STRAATEN.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
