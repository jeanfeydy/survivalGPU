<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fast WCE — wceGPU • survivalGPU</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fast WCE — wceGPU"><meta property="og:description" content="New implementation of the Weighted Cumulative Exposure model
(see @details), compatible with GPU to accelerate calculation speed and
work with large datasets.
Use summary() and plot() methods to see results and risk function."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survivalGPU</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="dropdown-header">Models</li>
    <li>
      <a href="../articles/coxPH.html">Cox Proportional Hazards regression</a>
    </li>
    <li>
      <a href="../articles/WCE.html">Weighted Cumulative Exposure : Signal detection</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/python_connect.html">Python Configuration</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/jeanfeydy/survivalGPU/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fast WCE</h1>
    <small class="dont-index">Source: <a href="https://github.com/jeanfeydy/survivalGPU/blob/HEAD/R/wceGPU.R" class="external-link"><code>R/wceGPU.R</code></a></small>
    <div class="hidden name"><code>wceGPU.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>New implementation of the Weighted Cumulative Exposure model
(see @details), compatible with GPU to accelerate calculation speed and
work with large datasets.</p>
<p>Use <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> methods to see results and risk function.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">wceGPU</span><span class="op">(</span><span class="va">data</span>, <span class="va">nknots</span>, <span class="va">cutoff</span>, constrained <span class="op">=</span> <span class="cn">FALSE</span>, aic <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">id</span>,</span>
<span>       <span class="va">event</span>, <span class="va">start</span>, <span class="va">stop</span>, <span class="va">expos</span>, covariates <span class="op">=</span> <span class="cn">NULL</span>, nbootstraps <span class="op">=</span> <span class="fl">1</span>,</span>
<span>       batchsize <span class="op">=</span> <span class="fl">0</span>, confint <span class="op">=</span> <span class="fl">0.95</span>, controls <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for wceGPU</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for wceGPU</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, hist.covariates <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for wceGPU</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">parm</span>, level <span class="op">=</span> <span class="fl">0.95</span>, <span class="va">...</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>A data frame in an interval (long) format, in which each line
corresponds to one and only one time unit for a given individual.</p></dd>


<dt>nknots</dt>
<dd><p>Corresponds to the number(s) of interior knots for the cubic
splines to estimate the weight function. For example, if nknots is set to
2, then a model with two interior knots is fitted.</p></dd>


<dt>cutoff</dt>
<dd><p>Integer. Time window over which the WCE model is estimated.
Corresponds to the length of the estimated weight function.</p></dd>


<dt>constrained</dt>
<dd><p>Controls whether the weight function should be constrained
to smoothly go to zero. Set to FALSE for unconstrained models, to 'Right'
or 'R' to constrain the weight function to smoothly go to zero for exposure
remote in time, and to 'Left' or 'L' to constrain the weight function to
start a zero for the current values.</p></dd>


<dt>aic</dt>
<dd><p>Logical. If TRUE, then the AIC is used to select the best fitting
model among those estimated for the different numbers of interior knots
requested with nknots. If FALSE, then the BIC is used instead of the AIC.
Default to FALSE (BIC). Note that the BIC implemented in WCE is the version
suggested by Volinsky and Raftery in Biometrics (2000), which corresponds
to BIC = 2 * log(PL) + p * log(d) where PL is the model's partial
likelihood, p is the number of estimated parameters and d is the number of
uncensored events. See Sylvestre and Abrahamowicz (2009) for more details.</p></dd>


<dt>id</dt>
<dd><p>Name of the variable in data corresponding to the identification of
subjects.</p></dd>


<dt>event</dt>
<dd><p>Name of the variable in data corresponding to event indicator.
Must be coded 1 = event and 0 = no event.</p></dd>


<dt>start</dt>
<dd><p>Name of the variable in data corresponding to the starting time
for the interval. Corresponds to time argument in function Surv in the
survival package.</p></dd>


<dt>stop</dt>
<dd><p>Name of the variable in data corresponding to the ending time for
the interval. Corresponds to time2 argument in function Surv in the
survival package.</p></dd>


<dt>expos</dt>
<dd><p>Name of the variable in data corresponding to the exposure
variable.</p></dd>


<dt>covariates</dt>
<dd><p>Optional. Vector of characters corresponding to the name(s)
of the variable(s) in data corresponding to the covariate(s) to be included
in the model. Default to NULL, which corresponds to fitting model(s)
without covariates.</p></dd>


<dt>nbootstraps</dt>
<dd><p>Number of repeats for the bootstrap cross-validation.</p></dd>


<dt>batchsize</dt>
<dd><p>Number of bootstrap copies that should be handled at a time.
Defaults to 0, which means that we handle all copies at once. If you run
into out of memory errors, please consider using batchsize=100, 10 or 1.</p></dd>


<dt>confint</dt>
<dd><p>Level for confidence intervals. Default to 0.95.</p></dd>


<dt>controls</dt>
<dd><p>List corresponding to the control parameters to be passed to
the coxph function. See coxph.control for more details.</p></dd>


<dt>...</dt>
<dd><p>additional argument(s) for methods.</p></dd>


<dt>object</dt>
<dd><p>wceGPU object.</p></dd>


<dt>x</dt>
<dd><p>wceGPU object.</p></dd>


<dt>hist.covariates</dt>
<dd><p>show histogram for each covariates if you use
bootstrap.</p></dd>


<dt>parm</dt>
<dd><p>a specification of which parameters are to be given confidence
intervals, either a vector of numbers or a vector of names. If missing, all
parameters are considered.</p></dd>


<dt>level</dt>
<dd><p>the confidence level required.</p></dd>


<dt>digits</dt>
<dd><p>significant digits to print.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>WCE results</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>WCE implements a flexible method for modeling cumulative effects of
time-varying exposures, weighted according to their relative proximity in
time, and represented by time-dependent covariates. The current
implementation estimates the weight function in the Cox proportional
hazards model. The function that assigns weights to doses taken in the past
is estimated using cubic regression splines.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Sylvestre MP, Abrahamowicz M. Flexible modeling of the cumulative
effects of time-dependent exposures on the hazard. Stat Med. 2009 Nov
30;28(27):3437-53.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Dataset</span></span></span>
<span class="r-in"><span><span class="va">drugdata</span> <span class="op">&lt;-</span> <span class="fu">WCE</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/WCE/man/drugdata.html" class="external-link">drugdata</a></span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># WCE model</span></span></span>
<span class="r-in"><span><span class="va">wce_gpu</span> <span class="op">&lt;-</span> <span class="fu">wceGPU</span><span class="op">(</span>data <span class="op">=</span> <span class="va">drugdata</span>, nknots <span class="op">=</span> <span class="fl">1</span>, cutoff <span class="op">=</span> <span class="fl">90</span>, id <span class="op">=</span> <span class="st">"Id"</span>,</span></span>
<span class="r-in"><span>                  event <span class="op">=</span> <span class="st">"Event"</span>, start <span class="op">=</span> <span class="st">"Start"</span>, stop <span class="op">=</span> <span class="st">"Stop"</span>,</span></span>
<span class="r-in"><span>                  expos <span class="op">=</span> <span class="st">"dose"</span>, covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  constrained <span class="op">=</span> <span class="cn">FALSE</span>, aic <span class="op">=</span> <span class="cn">FALSE</span>, confint <span class="op">=</span> <span class="fl">0.95</span>,</span></span>
<span class="r-in"><span>                  nbootstraps <span class="op">=</span> <span class="fl">1</span>, batchsize <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Results</span></span></span>
<span class="r-in"><span><span class="va">wce_gpu</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">wce_gpu</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># See estimated weight function</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">wce_gpu</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># WCE model with bootstrap (example with 20 bootstraps, but normally</span></span></span>
<span class="r-in"><span><span class="co"># nbootstraps &gt; 500)</span></span></span>
<span class="r-in"><span><span class="va">wce_gpu_bootstrap</span> <span class="op">&lt;-</span> <span class="fu">wceGPU</span><span class="op">(</span>data <span class="op">=</span> <span class="va">drugdata</span>, nknots <span class="op">=</span> <span class="fl">1</span>, cutoff <span class="op">=</span> <span class="fl">90</span>,</span></span>
<span class="r-in"><span>                            id <span class="op">=</span> <span class="st">"Id"</span>, event <span class="op">=</span> <span class="st">"Event"</span>, start <span class="op">=</span> <span class="st">"Start"</span>,</span></span>
<span class="r-in"><span>                            stop <span class="op">=</span> <span class="st">"Stop"</span>, expos <span class="op">=</span> <span class="st">"dose"</span>,</span></span>
<span class="r-in"><span>                            covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            constrained <span class="op">=</span> <span class="cn">FALSE</span>, aic <span class="op">=</span> <span class="cn">FALSE</span>, confint <span class="op">=</span> <span class="fl">0.95</span>,</span></span>
<span class="r-in"><span>                            nbootstraps <span class="op">=</span> <span class="fl">20</span>, batchsize <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># See confidence bands for the estimated weight function due to bootstrap</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">wce_gpu_bootstrap</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># All estimated coefficients in bootstrap</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">wce_gpu_bootstrap</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Estimate a HR (Exposed at a dose vs. unexposed)</span></span></span>
<span class="r-in"><span><span class="va">exposed</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">90</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">unexposed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="HR.html">HR</a></span><span class="op">(</span><span class="va">wce_gpu_bootstrap</span>, <span class="va">exposed</span>, <span class="va">unexposed</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jean FEYDY, Alexis van STRAATEN.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

